{% extends "order/sales_order_base.html" %}

{% load inventree_extras %}
{% load status_codes %}
{% load i18n %}
{% load static %}

{% block details %}

{% include 'order/so_tabs.html' with tab='details' %}

<hr>

<h4>{% trans "Sales Order Items" %}</h4>

<div id='order-toolbar-buttons' class='btn-group' style='float: right;'>
    {% if order.status == OrderStatus.PENDING %}
    <button type='button' class='btn btn-default' id='new-po-line'>{% trans "Add Line Item" %}</button>
    {% endif %}
</div>

<table class='table table-striped table-condensed' id='so-lines-table' data-toolbar='#order-toolbar-buttons'>

</table>

{% endblock %}

{% block js_ready %}
{{ block.super }}

$("#so-lines-table").inventreeTable({
    formatNoMatches: function() { return "No matching line items"; },
    queryParams: {
        order: {{ order.id }},
        part_detail: true,
    },
    url: "{% url 'api-so-line-list' %}",
    columns: [
        {
            field: 'pk',
            title: 'ID',
            visible: false,
        },
        {
            sortable: true,
            field: 'part',
            title: 'Part',
            formatter: function(value, row, index, field) {
                if (row.part) {
                    return imageHoverIcon(row.part_detail.thumbnail) + renderLink(row.part_detail.full_name, `/part/${value}/`);
                } else {
                    return '-';
                }
            }
        },
        {
            sortable: true,
            field: 'reference',
            title: 'Reference'
        },
        {
            sortable: true,
            field: 'quantity',
            title: 'Quantity',
            formatter: function(value, row, index, field) {
                return +parseFloat(value).toFixed(5);
            }
        },
        {
            field: 'notes',
            title: 'Notes',
        },
    ],
    });

{% endblock %}