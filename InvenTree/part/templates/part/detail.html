{% extends "part/part_base.html" %}
{% load static %}
{% block details  %}

{% include 'part/tabs.html' with tab='detail' %}

<div class='row'>
    <div class='col-sm-6'>
    </div>
    <div class='col-sm-6'>
        <div class="btn-group" style="float: right;">
            <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Options
            <span class="caret"></span></button>
            <ul class="dropdown-menu">
                {% if part.active %}
                <li><a href="#" id='edit-part' title='Edit part'>Edit</a></li>
                {% if part.purchaseable %}
                <li><a href='#' id='order-part' title='Order part'>Order</a></li>
                {% endif %}
                <li><a href='#' id='duplicate-part' title='Duplicate Part'>Duplicate</a></li>
                <hr>
                <li><a href="#" id='deactivate-part' title='Deactivate part'>Deactivate</a></li>
                {% else %}
                <li><a href="#" id='activate-part' title='Activate part'>Activate</a></li>
                <li><a href='#' id='delete-part' title='Delete part'>Delete</a></li>
                {% endif %}
            </ul>
        </div>
    </div>
</div>

<div class='row'>
    <div class='col-sm-6'>
        <h4>Part Details</h4>
    <table class='table table-striped'>
        <tr>
            <td><b>Part name</b></td>
            <td>{{ part.full_name }}</td>
        </tr>
        {% if part.IPN %}
        <tr>
            <td><b>IPN</b></td>
            <td>{{ part.IPN }}</td>
        </tr>
        {% endif %}
        <tr>
            <td><b>Description</b></td>
            <td>{{ part.description }}</td>
        </tr>
        {% if part.variant_of %}
        <tr>
            <td><b>Variant Of</b></td>
            <td><a href="{% url 'part-detail' part.variant_of.id %}">{{ part.variant_of.full_name }}</a></td>
        </tr>
        {% endif %}
        {% if part.keywords %}
        <tr>
            <td><b>Keywords</b></td>
            <td>{{ part.keywords }}</td>
        </tr>
        {% endif %}
        {% if part.URL %}
        <tr>
            <td><b>URL</b></td>
            <td><a href="{{ part.URL }}">{{ part.URL }}</a></td>
        </tr>
        {% endif %}
        <tr>
            <td><b>Category</b></td>
            <td>
            {% if part.category %}
                <a href="{% url 'category-detail' part.category.id %}">{{ part.category.pathstring }}</a>
            {% endif %}
            </td>
        </tr>
        {% if part.default_location %}
        <tr>
            <td><b>Default Location</b></td>
            <td><a href="{% url 'stock-location-detail' part.default_location.id %}">{{ part.default_location.pathstring }}</a></td>
        </tr>
        {% endif %}
        {% if part.default_supplier %}
        <tr>
            <td><b>Default Supplier</b></td>
            <td><a href="{% url 'supplier-part-detail' part.default_supplier.id %}">
                {{ part.default_supplier.supplier.name }} | {{ part.default_supplier.SKU }}
            </a></td>
        </tr>
        {% endif %}
        <tr>
            <td><b>Units</b></td>
            <td>{{ part.units }}</td>
        </tr>
        {% if part.minimum_stock > 0 %}
        <tr>
            <td><b>Minimum Stock</b></td>
            <td>{{ part.minimum_stock }}</td>
        </tr>
        {% endif %}
    </table>
    </div>
    <div class='col-sm-6'>
        <h4>Part Type</h4>
    <table class='table table-striped'>
        <tr>
            <td><b>Assembly</b></td>
            <td>{% include "slide.html" with state=part.assembly %}</td>   
            <td><i>This part can be assembled from other parts</i></td>
        </tr>
        <tr>
            <td><b>Component</b></td>
            <td>{% include "slide.html" with state=part.component %}</td>   
            <td><i>This part can be used in assemblies</i></td>
        </tr>
        <tr>
            <td><b>Trackable</b></td>
            <td>{% include "slide.html" with state=part.trackable %}</td>   
            <td><i>Stock for this part will be tracked by (serial or batch)</i></td>
        </tr>
        <tr>
            <td><b>Purchaseable</b></td> 
            <td>{% include "slide.html" with state=part.purchaseable %}</td>   
            <td><i>This part can be purchased from external suppliers</i></td>
        </tr>
        <tr>
            <td><b>Sellable</b></td>
            <td>{% include "slide.html" with state=part.salable %}</td>
            <td><i>This part can be sold to customers</i></td>
        </tr>
    </table>
    </div>
</div>

{% if part.notes %}
<div class="panel panel-default">
  <div class="panel-heading"><b>Notes</b></div>
  <div class="panel-body">{{ part.notes }}</div>
</div>
{% endif %}

{% endblock %}

{% block js_load %}
{{ block.super }}
{% endblock %}

{% block js_ready %}
    {{ block.super }}
    
    $("#duplicate-part").click(function() {
        launchModalForm(
            "{% url 'part-duplicate' part.id %}",
            {
                follow: true,
            }
        );
    });

    $("#order-part").click(function() {
        launchModalForm("/order/purchase-order/order-parts/", {
            data: {
                part: {{ part.id }},
            },
        });
    });
    
    $("#edit-part").click(function() {
        launchModalForm(
                        "{% url 'part-edit' part.id %}",
                        {
                            reload: true,
                        });
    });

    $('#activate-part').click(function() {
        showQuestionDialog(
            'Activate Part?',
            'Are you sure you wish to reactivate {{ part.full_name }}?',
            {
                accept_text: 'Activate',
                accept: function() {
                    inventreePut(
                        "{% url 'api-part-detail' part.id %}",
                        {
                            active: true,
                        },
                        {
                            method: 'PATCH',
                            reloadOnSuccess: true,
                        }
                    );
                }
            },
        );
    });

    $('#deactivate-part').click(function() {
        showQuestionDialog(
            'Deactivate Part?',
            `Are you sure you wish to deactivate {{ part.full_name }}?<br>
            `,
            {
                accept_text: 'Deactivate',
                accept: function() {
                    inventreePut(
                        "{% url 'api-part-detail' part.id %}",
                        {
                            active: false,
                        },
                        {
                            method: 'PATCH',
                            reloadOnSuccess: true,
                        }
                    );
                }
            }
        );
    });


    $('#delete-part').click(function() {
        launchModalForm(
            "{% url 'part-delete' part.id %}",
            {
                redirect: {% if part.category %}"{% url 'category-detail' part.category.id %}"{% else %}"{% url 'part-index' %}"{% endif %}
            });
    });

{% endblock %}
