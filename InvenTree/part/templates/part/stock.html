{% extends "part/part_base.html" %}
{% load static %}
{% block details %}

{% include 'part/tabs.html' with tab='stock' %}

<h3>Part Stock</h3>

<table class="table table-striped" id='stock-table' data-sorting='true'>
<thead>
<tr>
    <th data-sortable='false'>Link</th>
    {% if part.trackable %}
    <th>Serial Number</th>
    {% else %}
    <th>Quantity</th>
    {% endif %}
    <th>Location</th>
    <th>Supplier part</th>
    <th>Stocktake</th>
    <th>Notes</th>
</tr>
</thead>
<tbody>
{% for stock in part.locations.all %}
<tr>
    <td><a href="{% url 'stock-item-detail' stock.id %}">Click</a></td>
    <td>
        {% if part.trackable %}
        {{ stock.serial }}
        {% else %}
        {{ stock.quantity }}
        {% endif %}
    </td>
    <td>
        {% if stock.location %}
        <a href="{% url 'stock-location-detail' stock.location.id %}">{{ stock.location.name }}</a>
        {% endif %}
    </td>
    <td>
        {% if stock.supplier_part %}
    <a href="{% url 'supplier-part-detail' stock.supplier_part.id %}">
        {{ stock.supplier_part.supplier.name }} | {{ stock.supplier_part.SKU }}
    </a>
        {% endif %}
    </td>
    <td>{% if stock.stocktake_date %}{{ stock.stocktake_date }}{% endif %}</td>
    <td>{{ stock.notes }}</td>
</tr>
{% endfor %}
</tbody>
</table

<div class='container-fluid'>
<button class='btn btn-success' id='add-stock-item'>Add new Stock Item</button>
</div>

{% endblock %}

{% block js_load %}
{{ block.super }}
<script type='text/javascript' src="{% static 'script/footable.js' %}"></script>
{% endblock %}
{% block js_ready %}
{{ block.super }}
    $('#stock-table').footable();

    $('#add-stock-item').click(function () {
        launchModalForm("#modal-form",
                        "{% url 'stock-item-create' %}",
                        {
                            reload: true,
                            data: {
                                part: {{ part.id }}
                            }
                        });
    });
{% endblock %}