{% extends "part/part_base.html" %}
{% load static %}

{% block css %}

{% endblock %}

{% block details %}

{% include 'part/tabs.html' with tab='bom' %}

<h3>Bill of Materials{% if editing_enabled %} (Edit Mode){% endif %}</h3>

<table class='table table-striped table-condensed' id='bom-table'>
</table>

<div><br></div>

{% if editing_enabled %}
<div class='btn-group' style='float: left;'>
    <button class='btn btn-basic' type='button' id='bom-item-new'>New</button>
    <button class='btn btn-basic' type='button' id='bom-item-new'>Edit</button>
    <button class='btn btn-basic' type='button' id='bom-item-new'>Delete</button>
</div>
<div style='float: right;'>
    <button class='btn btn-warning' type='button' id='editing-cancel'>Cancel</button>
    <button class='btn btn-success' type='button' id='editing-finish'>Save Changes</button>
</div>
{% else %}
<div class='dropdown' style="float: right;">
    <button class='btn btn-primary dropdown-toggle' type='button' data-toggle='dropdown'>
        Options
        <span class='caret'></span>
    </button>
    <ul class='dropdown-menu'>
        <li><a href='#' id='edit-bom' title='Edit BOM'>Edit BOM</a></li>
        <li><a href='#' id='export-bom' title='Export BOM'>Export BOM</a></li>
    </ul>
</div>
{% endif %}

{% endblock %}

{% block js_load %}
{{ block.super }}
<script type='text/javascript' src="{% static 'script/inventree/api.js' %}"></script>
<script type='text/javascript' src="{% static 'script/inventree/part.js' %}"></script>
<script type='text/javascript' src="{% static 'script/inventree/bom.js' %}"></script>
{% endblock %}

{% block js_ready %}
{{ block.super }}

    loadBomTable($("#bom-table"), {
        editable: {{ editing_enabled }},
        bom_url: "{% url 'api-bom-list' %}",
        part_url: "{% url 'api-part-list' %}",
        parent_id: {{ part.id }} 
    });

    $("#edit-bom").click(function () {
        
        {% if editing_enabled %}
        location.href = "{% url 'part-bom' part.id %}";
        {% else %}
        location.href = "{% url 'part-bom' part.id %}?edit=True";
        {% endif %}
    });

    $("#export-bom").click(function () {
        //TODO - Select format of the data
        location.href = "{% url 'bom-export' part.id %}";
    });

    $("#bom-item-new").click(function () {
        launchModalForm("{% url 'bom-item-create' %}?parent={{ part.id }}", {});
    });

{% endblock %}