{% extends "part/part_base.html" %}
{% load static %}

{% block details %}

{% include 'part/tabs.html' with tab='attachments' %}

<div class='row'>
    <div class='col-sm-6'>
        <h4>Part Attachments</h4>
    </div>
    <div class='col-sm-6'>
        <div class="btn-group" style="float: right;">
                <button type='button' class='btn btn-success' id='new-attachment'>Add Attachment</button>
        </div>
    </div>
</div>

<hr>

<table class='table table-striped table-condensed' data-toolbar='#toolbar' id='attachment-table'>
<tr>
    <th>File</th>
    <th>Comment</th>
    <th></th>
</tr>
{% for attachment in part.attachments.all %}
<tr>
    <td><a href='/media/{{ attachment.attachment }}'>{{ attachment.basename }}</a></td>
    <td>{{ attachment.comment }}</td>
    <td>
        <div class='btn-group' style='float: right;'>    
            <button type='button' class='btn btn-primary attachment-edit-button' url="{% url 'part-attachment-edit' attachment.id %}" data-toggle='tooltip' title='Edit attachment ({{ attachment.basename }})'><span class='glyphicon glyphicon-small glyphicon-pencil'></span></button>
            <button type='button' class='btn btn-danger attachment-delete-button' url="{% url 'part-attachment-delete' attachment.id %}" data-toggle='tooltip' title='Delete attachment ({{ attachment.basename }})'><span class='glyphicon glyphicon-small glyphicon-trash'></span></button>
        </div>
    </td>
</tr>
{% endfor %}
{% if part.variant_of and part.variant_of.attachments.count > 0 %}
<tr>
    <td colspan='3'>
        Attachments for template part <b><i>{{ part.variant_of.full_name }}</i></b>
    </td>
</tr>
{% for attachment in part.variant_of.attachments.all %}
<tr>
    <td><a href='/media/{{ attachment.attachment }}'>{{ attachment.basename }}</a></td>
    <td>{{ attachment.comment }}</td>
    <td></td>
</tr>
{% endfor %}
{% endif %}
</table>

{% endblock %}

{% block js_ready %}
{{ block.super }}

    $("#new-attachment").click(function() {
        launchModalForm("{% url 'part-attachment-create' %}?part={{ part.id }}",
            {
                reload: true, 
            });
    });

    $("#attachment-table").on('click', '.attachment-edit-button', function() {
        var button = $(this);

        launchModalForm(button.attr('url'), 
            {
                reload: true,
            });
    });

    $("#attachment-table").on('click', '.attachment-delete-button', function() {
        var button = $(this);

        launchModalForm(button.attr('url'), {
            success: function() {
                location.reload();
            }
        });
    });

{% endblock %}