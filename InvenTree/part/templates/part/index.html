{% extends "base.html" %}
{% load static %}

{% block css %}
<link rel='stylesheet' href="{% static 'css/bootstrap-treeview.css' %}">
{% endblock %}

{% block content %}

{% include "part/cat_link.html" with category=category %}

{% include 'modals.html' %}

{% if children.all|length > 0 %}
<h4>Part Categories</h4>
{% include "part/category_subcategories.html" with children=children %}
{% endif %}

<h4>Parts</h4>
{% include "part/category_parts.html" with parts=parts %}

<div class='container-fluid'>
<button type='button' class='btn btn-primary' id='create-cat'>
    New Category
</button>
<button class="btn btn-success" id='create-part'>New Part</button>
</div>
{% endblock %}

{% block js_load %}

<script type='text/javascript' src="{% static 'script/footable.js' %}"></script>
<script type='text/javascript' src="{% static 'script/modal_form.js' %}"></script>
{% endblock %}
{% block js_ready %}
    $('#part-list').footable();

    $("#create-cat").click(function() {
        launchModalForm("#modal-form",
                        "{% url 'category-create' %}",
                        {
                            follow: true
                        });
    });

    function loadTree() {
        var requestData = {};

        {% if category %}
        requestData.category = {{ category.id }};
        {% endif %}

        $.ajax({
            url: "{% url 'api-part-tree' %}",
            type: 'get',
            dataType: 'json',
            data: requestData,
            success: function (response) {
                if (response.tree) {
                    $("#part-tree").treeview({
                        data: response.tree,
                        enableLinks: true
                    });
                }
            },
            error: function (xhr, ajaxOptions, thrownError) {
                alert('Error retrieving part tree:\n' + thrownError);
            }
        });
    }

    $("#create-part").click(function() {
        launchModalForm("#modal-form", "{% url 'part-create' %}");
    });

    loadTree();

{% endblock %}
