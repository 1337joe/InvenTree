{% extends "base.html" %}
{% load static %}
{% block content %}

{% include "stock/loc_link.html" with location=location %}

<div class='row'>
<div class='col-sm-6'>
    <h3>{{ location.name }}</h3>
    <p>{{ location.description }}</p>
</div>
<div class='col-sm-6'>
    <h3>
    <div style='float: right;'>
    <button class='btn btn-success' id='location-create'>New Stock Location</button>
    <div class="dropdown" style="float: right;">
        <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Stock Location
        <span class="caret"></span></button>
        <ul class="dropdown-menu">
          <li><a href="#" id='location-edit' title='Edit stock location'>Edit</a></li>
          <li><a href="#" id='location-delete' title='Delete stock location'>Delete</a></li>
        </ul>
    </div>
    </div>
    </h3>
</div>
</div>

{% if location.has_children %}
<h3>Sub Locations</h3>
{% include "stock/location_list.html" with locations=location.children %}
{% endif %}

{% if location.has_items %}
<table class='table table-striped table-condensed' id='stock-table'>
</table>
{% endif %}

<div class='container-fluid' style='float: right;'>
    <button class="btn btn-success" id='item-create'>New Stock Item</span></button>
    <div class="dropdown" style='float: right;'>
        <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Selected
        <span class="caret"></span></button>
        <ul class="dropdown-menu">
            <li><a href="#" id='multi-item-stocktake' title='Stocktake selected stock items'>Stocktake</a></li>
          <li><a href='#' id='multi-item-move' title='Move selected stock items'>Move</a></li>
          <li><a href="#" id='multi-item-delete' title='Delete selected stock items'>Delete</a></li>
        </ul>
    </div>
</div>

{% include 'modals.html' %}

{% endblock %}

{% block js_load %}
<script type='text/javascript' src="{% static 'script/modal_form.js' %}"></script>
{% endblock %}
{% block js_ready %}

    $('#location-create').click(function () {
        launchModalForm("#modal-form",
                        "{% url 'stock-location-create' %}",
                        {
                            data: {
                                location: {{ location.id }}
                            },
                            follow: true
                        });
        return false;
    });

    $('#location-edit').click(function() {
        launchModalForm("#modal-form",
                        "{% url 'stock-location-edit' location.id %}",
                        {
                            reload: true
                        });
        return false;
    });

    $('#location-delete').click(function() {
        launchDeleteForm("#modal-delete",
                         "{% url 'stock-location-delete' location.id %}",
                         {
                             redirect: "{% url 'stock-index' %}"
                         });
        return false;
    })

    $('#item-create').click(function () {
        launchModalForm("#modal-form",
                        "{% url 'stock-item-create' %}",
                        {
                            success: function() {
                                $("#stock-table").bootstrapTable('refresh');
                            },
                            data: {
                                location: {{ location.id }}
                            }
                        });

        return false;
    });

    function selectedStock() {
        return $("#stock-table").bootstrapTable('getSelections');
    }

    $("#multi-item-move").click(function() {

        var items = selectedStock();

        alert('Moving ' + items.length + ' items');

        return false;
    });

    $("#multi-item-delete").click(function() {

        var items = selectedStock();

        alert('Deleting ' + items.length + ' items');

        return false;
    });

    $("#multi-item-stocktake").click(function() {
        var items = selectedStock();

        alert('Stocktake on ' + items.length + ' items');

        return false;
    });

    {% include 'stock/stock_table.html' with location=location %}

{% endblock %}
