{% extends "base.html" %}
{% load static %}

{% block page_title %}
InvenTree | Build - {{ build }}
{% endblock %}

{% block content %}

<div class='row'>
<div class='col-sm-6'>
    <h3>Build Details</h3>
    <p><b>{{ build.title }}</b>{% include "build_status.html" with build=build %}</p>
    <p>Building {{ build.quantity }} &times {{ build.part.full_name }}</p>
</div>
<div class='col-sm-6'>
    <h3>
    <div style='float: right;'>
    <div class="dropdown" style="float: right;">
        <a href="{% url 'build-allocate' build.id %}">
            <button class='btn btn-info' type='button' title='Allocate Parts' id='build-allocate'>Allocate Parts</button>
        </a>
        <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Options
        <span class="caret"></span></button>
        <ul class="dropdown-menu">
          <li><a href='#' id='build-edit' title='Edit build'>Edit build</a></li>
          {% if build.is_active %}
          <li><a href='#' id='build-complete' title='Complete Build'>Complete Build</a></li>
          <li><a href='#' id='build-cancel' title='Cancel build'>Cancel build</a></li>
          {% endif %}
        </ul>
    </div>
    </div>
    </h3>
</div>
</div>

<table class='table table-striped'>
<tr>
    <td>Title</td><td>{{ build.title }}</td>
</tr>
<tr>
    <td>Part</td><td><a href="{% url 'part-build' build.part.id %}">{{ build.part.full_name }}</a></td>
</tr>
<tr>
    <td>Quantity</td><td>{{ build.quantity }}</td>
</tr>
<tr>
    <td>Stock Source</td>
    <td>
        {% if build.take_from %}
        <a href="{% url 'stock-location-detail' build.take_from.id %}">{{ build.take_from }}</a>
        {% else %}
        Stock can be taken from any available location.
        {% endif %}
    </td>
</tr>
<tr>
    <td>Status</td><td>{% include "build_status.html" with build=build %}</td>
</tr>
{% if build.batch %}
<tr>
    <td>Batch</td><td>{{ build.batch }}</td>
</tr>
{% endif %}
{% if build.URL %}
<tr>
    <td>URL</td><td><a href="{{ build.URL }}">{{ build.URL }}</a></td>
</tr>
{% endif %}
<tr>
    <td>Created</td><td>{{ build.creation_date }}</td>
</tr>
{% if build.is_active %}
<tr>
    <td>Enough Parts?</td>
    <td>
        {% if build.can_build %}
        Yes
        {% else %}
        No
        {% endif %}
    </td>
</tr>
{% endif %}
{% if build.completion_date %}
<tr>
    <td>Completed</td><td>{{ build.completion_date }}{% if build.completed_by %}<span class='badge'>{{ build.completed_by }}</span>{% endif %}</td>
</tr>
{% endif %}
{% if build.notes %}
<tr>
    <td>Notes</td><td>{{ build.notes }}</td>
</tr>
{% endif %}
</table>

{% if build.is_active %}
<h3>Required Parts</h3>
<table class='table table-striped' id='build-list' data-sorting='true'>
<thead>
<tr>
    <th>Part</th>
    <th>Required</th>
    <th>Available</th>
    <th>Allocated</th>
</tr>
</thead>
<tbody>
    {% for item in build.required_parts %}
    <tr>
        <td><a href="{% url 'part-detail' item.part.id %}">{{ item.part.full_name }}</a></td>
        <td>{{ item.quantity }}</td>
        <td>{{ item.part.total_stock }}</td>
        <td>{{ item.allocated }}</td>
    </tr>
    {% endfor %}
</tbody>
</table>

{% endif %}

{% include 'modals.html' %}

{% endblock %}

{% block js_ready %}
{{ block.super }}
    $("#build-edit").click(function () {
        launchModalForm("{% url 'build-edit' build.id %}",
                        {
                            reload: true
                        });
    });

    $("#build-cancel").click(function() {
        launchModalForm("{% url 'build-cancel' build.id %}",
                        {
                            reload: true,
                            submit_text: "Cancel Build",
                        });
    });

    $("#build-complete").on('click', function() {
        launchModalForm(
            "{% url 'build-complete' build.id %}",
            {
                reload: true,
                submit_text: "Complete Build",
            }
        );
    });

{% endblock %}
